<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
          integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

  <script type="module" src="./js/commentFunction.js"></script>
  <link href="css/detail.css" rel="stylesheet">
</head>
<body>
<div class="all-content">
  <div class="detail-content">
    <div class="post-title">
<!--      <p style="font-size: 15px; color: darkgray ; padding-top: 15px"> 부산 사는 주짱이네</p>-->
      <h6></h6>
      <!--      <h1>부산 남천동 맛집/안목,미쉐린 가이드 부산 돼지국밥 웨이팅 후기</h1>-->
      <h1></h1>
      <hr style="align-content: center; border-top: 3px solid dimgray; width: 720px;">
      <br>
    </div>
    <div class="post-content">
      <!--<p>지난 2월 미쉐린 가이드 서울&부산 2024 발표가 있었죠?<br>부산은 올해 첫 미쉐린 가이드 발간 도시로 총 43개의 맛집들이 선정 되었는데요<br>미쉐린 가이드 빕 그루망 15곳 중 한 곳인 메뉴로 가장 끌렸던 돼지국밥 맛집 안목에 다녀왔습니다!</p>-->
      <!--<img src="https://firebasestorage.googleapis.com/v0/b/sparta-5c4c5.appspot.com/o/2_1.jpg?alt=media&token=4ef2b7df-2690-40f4-8f05-a780a9a54aab">-->
      <!--<p>매장 대기 오픈을 하려고 아침 일찍 체크아웃을 하고 안목으로 이동! 벌써부터 사람이 많네요 😲😲</p>-->
      <!--<img src="https://firebasestorage.googleapis.com/v0/b/sparta-5c4c5.appspot.com/o/2_2.jpg?alt=media&token=2649945c-026b-4412-aa3e-65436073cedd">-->
      <!--<p>아침부터 웨이팅이 있었어요!</p>-->
      <!--<img src="https://firebasestorage.googleapis.com/v0/b/sparta-5c4c5.appspot.com/o/2_3.jpg?alt=media&token=86688a88-49fb-4f3d-b038-3657c1ba90c1">-->
      <!--<p>입장할 순서가 됐다는 알림을 받고서 직원 안내에 따라 매장에 들어가고<br>자리에 앉기 전 키오스크로 메뉴 주문부터 합니다!</p>-->
      <!--<img src="https://firebasestorage.googleapis.com/v0/b/sparta-5c4c5.appspot.com/o/2_4.jpg?alt=media&token=fc8673ea-9653-459e-853e-39e6882dd26a">-->
      <!--<p>매장은 일자형 테이블로 총 14석 있습니다!<br>2인 기준으로 7팀이 들어갈 수 있는 자리에요!</p>-->
      <!--<img src="https://firebasestorage.googleapis.com/v0/b/sparta-5c4c5.appspot.com/o/2_5.jpg?alt=media&token=49110590-f101-48de-987e-d6121302ab7a">-->
      <!--<p>머릿고기 국밥을 잠시 고민했었지만, 돼지국밥이 미쉐린 가이드 타이틀이라<br>돼지국밥으로 주문하고 단백질 보충을 위해 고기 많음으로!</p>-->
      <!--<img src="https://firebasestorage.googleapis.com/v0/b/sparta-5c4c5.appspot.com/o/2_6.jpg?alt=media&token=e8792a89-38f7-444a-b968-d0a432890ab2">-->
      <!--<p>잡내가 일단 없어요! 최근 돼지 곰탕을 먹어봤는데 비주얼이 비슷해서<br>너무 맑은 스타일이면 별로라고 생각했지만 국물이 깔끔하고 깊고 담백해요!</p>-->
      <!--<img src="https://firebasestorage.googleapis.com/v0/b/sparta-5c4c5.appspot.com/o/2_7.jpg?alt=media&token=43905883-fbc0-48a2-8e4d-84746c71040a">-->
      <!--<p>76분 기다린 보람이 가득했습니다<br>같이 간 일행들도 만족했지만 제가 특히나 너무 만족스러웠거든요<br>이래서 미쉐린 미쉐린 하는구나 싶은 맛?<br>깔끔한데 깊은 돼지국밥이라 국밥 좋아하시는 분들이라면 무조건 만족하실듯 해요!<br><br>미쉐린 돼지국밥 안목 덕분에 부산 여행이 완벽하게 마무리 되었습니다<br>다음에 부산 여행 가면 웨이팅 해도 또 먹을게요 シシ</p>-->
    </div>
  </div>

  <div class="detailbtn">
    <div class="likebtn">
      <button id="likeButton">🤍 좋아요</button>
    </div>
    <div class="commentbtn">
      <button id="commentVisibleBtn">💬 댓글 ︱ ▼</button>
    </div>
  </div>

  <div class="comment-box" style="display: none">
    <div class="comment-input-box">
      <div class="user-info">
        <label for="commentNickname"></label>
        <input type="text" id="commentNickname" placeholder="닉네임(8자리)" maxlength="8">
        <label for="commentPassword"></label>
        <input type="password" id="commentPassword" placeholder="비밀번호" maxlength="16">
      </div>
      <div class="input-box">
        <!--        <label for="commentInput" style="display: none"></label>-->
        <textarea id="commentInput" placeholder="내용 입력" oninput="resize(this)"></textarea>
      </div>
      <div class="button-box">
        <button id="commentButton">등록하기</button>
      </div>
    </div>

    <div class="comment-content-box">
      <ul id="comment-items">
      </ul>
    </div>
  </div>
</div>
<script>

    // 현재 detail 페이지
    const urlParams = new URL(location.href).searchParams;
    const currentDetail = parseInt(urlParams.get('detail'));
    console.log("detail = " + currentDetail + "\ntype = " + typeof currentDetail);

  // 좋아요 버튼 시작
  const likeButton = document.getElementById("likeButton");

    let checkCookie = getCookie("like");
    let loadCookie = checkCookie ? JSON.parse(checkCookie) : "{}";
    console.log("쿠키 = ", loadCookie + "\ntype = " + typeof loadCookie);

    let isHeart = false;
    if (checkCookie !== "") {
        // let temp_json = loadCookie;
        console.log("쿠키 value = " + loadCookie[currentDetail]);
        isHeart = loadCookie[currentDetail];
    }

  // 페이지 로드 시 쿠키에서 좋아요 수 가져오기
  if (isHeart) {
      document.getElementById("likeButton").innerHTML = `❤️ 좋아요`;
  } else {
      document.getElementById("likeButton").innerHTML = `🤍 좋아요`;
  }

  likeButton.addEventListener('click', function () {
    if (isHeart) {
      isHeart = false;
      document.getElementById("likeButton").innerHTML = `🤍 좋아요`;
    } else {
      isHeart = true;
      document.getElementById("likeButton").innerHTML = `❤️ 좋아요`;
    }

    // 좋아요 수 쿠키에 저장
    setCookie("like", createOrUpdateCookie(loadCookie, currentDetail, isHeart)); // 30일 동안 유지
  });

  function getCookie(name) {
    let nameEQ = name + "=";
    let cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      let cookie = cookies[i].trim();
      if (cookie.indexOf(nameEQ) === 0) {
        return cookie.substring(nameEQ.length, cookie.length);
      }
    }
    return null;
  }

  // 쿠키 설정 함수
  function setCookie(name, value) {
    let expires = "";
      let date = new Date();
      date.setTime(date.getTime() + (30 * 24 * 60 * 60 * 1000)); //30일
      expires = "; expires=" + date.toUTCString();

    document.cookie = name + "=" + value + expires + "; path=/";
  }

    // JSON 데이터에서 특정 키의 값을 변경 또는 추가하는 함수
    function createOrUpdateCookie(cookie, key, value) {
        cookie[key] = value;
        return JSON.stringify(cookie);
    }

  //좋아요 버튼 끝

  const commentVisibleBtn = document.getElementById('commentVisibleBtn');
  let isArrow = true;
  commentVisibleBtn.addEventListener('click', function () {
    if (isArrow) {
      commentVisibleBtn.textContent = '💬 댓글 ︱ ▲'; // 다른 이모지로 변경
    } else {
      commentVisibleBtn.textContent = '💬 댓글 ︱ ▼'; // 하트 이모지로 변경
    }
    $(".comment-box").toggle();
    isArrow = !isArrow;
  });
  <!--    지연-->
  const DEFAULT_HEIGHT = 68;

  function resize(obj) {
    obj.style.height = '0';
    if (obj.scrollHeight < DEFAULT_HEIGHT) {
      obj.style.height = -4 + obj.scrollHeight + 'px';
    } else {
      obj.style.height = obj.scrollHeight + 'px';
    }
  }

</script>
</body>
</html>
